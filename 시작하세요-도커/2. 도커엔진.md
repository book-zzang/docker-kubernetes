## ë„ì»¤ ì—”ì§„

### ë„ì»¤ ì´ë¯¸ì§€

- ì»¨í…Œì´ë„ˆ ìƒì„±í•  ë•Œ í•„ìš” ìš”ì†Œ
- ì—¬ëŸ¬ ê³„ì¸µìœ¼ë¡œ ëœ ë°”ì´ë„ˆë¦¬ íŒŒì¼
- ì»¨í…Œì´ë„ˆ ìƒì„±/ì‹¤í–‰ ì‹œ ì½ê¸° ì „ìš©ìœ¼ë¡œ ì‚¬ìš©
- ë³„ë„ ì„¤ì¹˜ í•„ìš” x
- ë„¤ì´ë°

  **// Todo: ë¡œì»¬ì— ìˆìœ¼ë©´??**

    ```jsx
    [ì €ì¥ì†Œ ì´ë¦„]/[ì´ë¯¸ì§€ ì´ë¦„]:[íƒœê·¸]

    ì €ì¥ì†Œ ì´ë¦„ : ìƒëµê°€ëŠ¥
    ì´ë¯¸ì§€ ì´ë¦„ : ìƒëµë¶ˆê°€
    íƒœê·¸ : ìƒëµì‹œ ìµœì‹ ë²„ì „
    ```

### ë„ì»¤ ì»¨í…Œì´ë„ˆ

**// Todo: ë„¤ì„ìŠ¤í˜ì´ìŠ¤??**

- ë„ì»¤ ì´ë¯¸ì§€ : ë„ì»¤ ì»¨í…Œì´ë„ˆ = 1 : N

  ë„ì»¤ ì»¨í…Œì´ë„ˆ ìƒì„± ì‹œ â†’ ì´ë¯¸ì§€ ì¢…ë¥˜ì— ë”°ë¼ ì•Œë§ì€ ì„¤ì •, íŒŒì¼ ê°€ì§

- ì´ë¯¸ì§€ëŠ” ì»¨í…Œì´ë„ˆì— ì˜í–¥ ë°›ì§€ ì•ŠìŒ
- ì»¨í…Œì´ë„ˆë¼ë¦¬ë„ ì˜í–¥ ë°›ì§€ ì•ŠìŒ

### ë„ì»¤ ì»¨í…Œì´ë„ˆ ë‹¤ë£¨ê¸°

// Todo: attachì™€ dettach???

```bash
# ë„ì»¤ ì—”ì§„ ë²„ì „
docker -v

# ë„ì»¤ ì»¨í…Œì´ë„ˆ ìƒì„±
docker run # ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ì§„ì… : pull -> create -> start -> attach(-i -t ì‚¬ìš© ì‹œ)
docker create # ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ì§„ì… x : pull -> create

# ì»¨í…Œì´ë„ˆ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ í™•ì¸
ì»¨í…Œì´ë„ˆ ì§„ì… -> ifconfig

docker run -i -t --name [ì»¨í…Œì´ë„ˆ ì´ë¦„] -p [í˜¸ìŠ¤íŠ¸ IP]:[í˜¸ìŠ¤íŠ¸ í¬íŠ¸]:[ì»¨í…Œì´ë„ˆ í¬íŠ¸] [ì´ë¯¸ì§€ ì´ë¦„]
docker create -i -t --name [ì»¨í…Œì´ë„ˆ ì´ë¦„] [ì´ë¯¸ì§€ ì´ë¦„]
# -i ì»¨í…Œì´ë„ˆì™€ ìƒí˜¸ ì…ì¶œë ¥ ê°€ëŠ¥
# -t tty í™œì„±í™”, ë°°ì‹œ(bash) ì…¸ ì‚¬ìš©í•˜ë„ë¡ ì„¤ì •
# --name ì»¨í…Œì´ë„ˆ ì´ë¦„ ì„¤ì •
# -p ì»¨í…Œì´ë„ˆì˜ í¬íŠ¸ë¥¼ í˜¸ìŠ¤íŠ¸ì˜ í¬íŠ¸ì™€ ë°”ì¸ë”©í•´ ì—°ê²°í•  ìˆ˜ ìˆê²Œ ì„¤ì •(í¬íŠ¸ í¬ì›Œë”©)
# -> í˜¸ìŠ¤íŠ¸ì˜ IPë¡œ ì»¨í…Œì´ë„ˆ ë‚´ ì›¹ì„œë²„ ì ‘ê·¼ ê°€ëŠ¥
# í˜¸ìŠ¤íŠ¸ IPì˜ í¬íŠ¸ ì ‘ê·¼ -> ì»¨í…Œì´ë„ˆ í¬íŠ¸ë¡œ í¬ì›Œë”© -> ì›¹ ì„œë²„ ì ‘ê·¼
# í˜¸ìŠ¤íŠ¸ IP íŠ¹ì • IP ì‚¬ìš©í•  ë•Œ ëª…ì‹œ

# ì»¨í…Œì´ë„ˆ ì´ë¦„ ë³€ê²½
docker rename [ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ì´ë¦„] [ë³€ê²½í•  ì»¨í…Œì´ë„ˆ ì´ë¦„]

# ì»¨í…Œì´ë„ˆ ì‹œì‘
docker start [ì»¨í…Œì´ë„ˆ ì´ë¦„] # ë’¤ì— ì»¨í…Œì´ë„ˆ ì´ë¦„ ì—¬ëŸ¬ê°œ ë¶™ì—¬ë„ ë¨(stop, restartë„ ë§ˆì°¬ê°€ì§€)

# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ì§„ì…
docker attach [ì»¨í…Œì´ë„ˆ ì´ë¦„]

# ì»¨í…Œì´ë„ˆ ë¹ ì ¸ë‚˜ì˜´, ì •ì§€ì‹œí‚´
exit
Ctrl + D

# ì •ì§€ ì—†ì´ ì»¨í…Œì´ë„ˆ ë¹ ì ¸ë‚˜ì˜´
Ctrl + P, Q

# ì´ë¯¸ì§€ ë‚´ë ¤ë°›ê¸°
docker pull centos:7

# ì´ë¯¸ì§€ ëª©ë¡ ì¶œë ¥
docker images

# ì»¨í…Œì´ë„ˆ ID ì¶œë ¥
docker inspect

# ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆ ëª©ë¡ ì¶œë ¥
docker ps

# ëª¨ë“  ì»¨í…Œì´ë„ˆ ëª©ë¡ ì¶œë ¥(ì •ì§€ í¬í•¨)
docker ps -a

# ì»¨í…Œì´ë„ˆ ëª©ë¡ ì¤‘ ì›í•˜ëŠ” ì •ë³´ë§Œ ì¶œë ¥
docker ps --format "table {{.ID}}\t{{.Status}}\t{{.Image}}"

# ì»¨í…Œì´ë„ˆ IDë§Œ ì¶œë ¥
docker ps -q

# ëª¨ë“  ì»¨í…Œì´ë„ˆ ëª©ë¡ì˜ IDë§Œ ì¶œë ¥ : docker ps -a -q

# ì¶œë ¥ ê²°ê³¼ : container id, image, command, created, status, ports, names
# command : ì´ë¯¸ì§€ ë‚´ì¥ ì»¤ë§¨ë“œ(createë‚˜ run ì˜ ë§¨ ëì— ì…ë ¥í•´ì„œ ì»¨í…Œì´ë„ˆ ìƒì„± ì‹œ ë®ì–´ì“¸ ìˆ˜ ìˆìŒ)
    # ex ) docker run -i -t ubuntu:14.04 echo hello world!
    # /bin/bash(ìƒí˜¸ ì…ì¶œë ¥ ê°€ëŠ¥í•œ ì‰˜ ì‹¤í–‰) ì‹¤í–‰ ë˜ì§€ ì•Šì•„ hello world! ì¶œë ¥ í›„ ì»¨í…Œì´ë„ˆ ì¢…ë£Œ

# ì»¨í…Œì´ë„ˆ ì •ì§€, ì‚­ì œ
docker stop [ì»¨í…Œì´ë„ˆ ì´ë¦„]
docker rm [ì»¨í…Œì´ë„ˆ ì´ë¦„]

# ì‹¤í–‰ì¤‘ì¸ ì»¨í…Œì´ë„ˆ ì‚­ì œ
docker rm -f [ì»¨í…Œì´ë„ˆ ì´ë¦„]

# ëª¨ë“  ì»¨í…Œì´ë„ˆ ì‚­ì œ
docker container prune
# or
docker stop $(docker ps -a -q)
docker rm $(docker ps -a -q)

# ì»¨í…Œì´ë„ˆ ì§„ì… í›„, ì•„íŒŒì¹˜ ì›¹ ì„œë²„ ì„¤ì¹˜(ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ì„¤ì¹˜, í˜¸ìŠ¤íŠ¸ì— ì˜í–¥ x)
// Todo: ì™œ ì´ë¯¸ì§€ë¡œ ì•ˆë°›ê³  install???
apt-get update
apt-get install apache2 -y
service apache2 start

# ì»¨í…Œì´ë„ˆ ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì¶•
// Todo : mysqlì€ ì‹¤í–‰ì‹œ mysqldê°€ ë™ì‘í•˜ë„ë¡ ì„¤ì • -> ìƒí˜¸ ì…ì¶œë ¥ ë¶ˆê°€ëŠ¥ 
// -> í”„ë¡œê·¸ë¨ í¬ê·¸ë¼ìš´ë“œë¡œ ì‹¤í–‰ë˜ëŠ” ê²ƒë§Œ ë³¼ ìˆ˜ ìˆìŒ(-i -t íƒœê·¸ x, )

# 1. mysql ì´ë¯¸ì§€ ì‚¬ìš©í•´ DBì»¨í…Œì´ë„ˆ ìƒì„±
docker run -d --name wordpressdb \
-e MYSQL_ROOT_PASSWORLD=password \
-e MYSQL_DATABASE=wordpress \
mysql:5.7

# 2. ë¯¸ë¦¬ ì¤€ë¹„ëœ ì›Œë“œí”„ë ˆìŠ¤ ì´ë¯¸ì§€ë¡œ ì›¹ ì„œë²„ ì»¨í…Œì´ë„ˆ ìƒì„±
docker run -d --name wordpress \
-e MYSQL_ROOT_PASSWORLD=password \
-p [ì»¨í…Œì´ë„ˆ í¬íŠ¸] \
wordpress
# í˜¸ìŠ¤íŠ¸ì˜ í¬íŠ¸ ì¤‘ í•˜ë‚˜ì™€ ì§€ì •í•œ ì»¨í…Œì´ë„ˆ í¬íŠ¸ì™€ ì—°ê²°
# docker ps ëª…ë ¹ì–´ í†µí•´ ì–´ë–¤ í˜¸ìŠ¤íŠ¸ í¬íŠ¸ì™€ ì—°ê²°ë˜ì—ˆëŠ”ì§€ í™•ì¸ ê°€ëŠ¥
# -e ì»¨í…Œì´ë„ˆ ë‚´ë¶€ í™˜ê²½ë³€ìˆ˜ ì„¤ì •

# í˜¸ìŠ¤íŠ¸ì™€ ë°”ì¸ë”© ëœ í¬íŠ¸ í™•ì¸
docker port [ì»¨í…Œì´ë„ˆ ì´ë¦„]

# í™˜ê²½ë³€ìˆ˜ í™•ì¸(attach)
echo ${ENVIRONMENT_NAME} # attach ëª…ë ¹ì–´ë¡œ ë‚´ë¶€ ë“¤ì–´ê°”ì„ ë•Œ 
# ex ) echo $MYSQL_ROOT_PASSWORD

# dettachì—ì„œ í„°ë¯¸ë„ ì‚¬ìš©
docker exec [ì»¨í…Œì´ë„ˆ ì´ë¦„] [ëª…ë ¹ì–´]
# ex ) docker exec wordpresssdb ls /
#      bin boot ...

# dettachì—ì„œ í„°ë¯¸ë„ ì‚¬ìš© & -i -t
docker exec -i -t [ì»¨í…Œì´ë„ˆ ì´ë¦„] [ëª…ë ¹ì–´]
# ex) docker exec -i -t wordpressdb /bin/bash # -d íƒœê·¸ë¡œ ìƒì„± ëì„ ë•Œ
#     echo $MYSQL_ROOT_PASSWORD
# -i -t ì˜µì…˜ ì¶”ê°€í•˜ë©´ /bin/bashë¥¼ ìƒí˜¸ ì…ì¶œë ¥ì´ ê°€ëŠ¥í•œ í˜•íƒœë¡œ exec ì‚¬ìš©????????????

# í™˜ê²½ë³€ìˆ˜ ì‚¬ìš©ë˜ì—ˆëŠ”ì§€ í™•ì¸
[ì´ë¯¸ì§€ ì´ë¦„] -u root -p
[password ì…ë ¥]

## ë¯¼ê° ì •ë³´ëŠ” ë‚´ë¶€ í™˜ê²½ë³€ìˆ˜ë¡œ ì²˜ë¦¬ x, ë„ì»¤ ìŠ¤ì›œëª¨ë“œì˜ secret or ì¿ ë²„ë„¤í‹°ìŠ¤ secret ì‚¬ìš©

# ë‚´ë¶€ IP ì•Œ í•„ìš” ì—†ì´ ì»¨í…Œì´ë„ˆì— ë³„ëª…ìœ¼ë¡œ ì ‘ê·¼
# --link ë³´ë‹¤ëŠ” ë„ì»¤ ë¸Œë¦¬ì§€ ë„¤íŠ¸ì›Œí¬ ì´ìš© ê¶Œì¥
... --link [ì»¨í…Œì´ë„ˆ ì´ë¦„]:[ë³„ëª…]
# ex ) docker exec wordpress curl mysql:3306 --silent 
```

```bash
docker run -d --name [ì»¨í…Œì´ë„ˆ ì´ë¦„] [ì´ë¯¸ì§€ ì´ë¦„]
# -d Detached ëª¨ë“œë¡œ ì»¨í…Œì´ë„ˆ ì‹¤í–‰(-i -tëŠ” attached ëª¨ë“œ)
```

- detached ëª¨ë“œ : ì»¨í…Œì´ë„ˆë¥¼ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë™ì‘í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ ì‹¤í–‰í•˜ë„ë¡ ì„¤ì •
    - // **Todo : nginx ì˜ˆì‹œ ì¶”ê°€!!!!!**
    - í‘œì¤€ ì…ì¶œë ¥ì´ ì—†ëŠ” ìƒíƒœë¡œ ì»¨í…Œì´ë„ˆ ì‹¤í–‰, ìƒí˜¸ì‘ìš© ë¶ˆê°€
    - ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰ë˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì²˜ëŸ¼ ì‹¤í–‰í•˜ë„ë¡
    - í¬ê·¸ë¼ìš´ë“œ : í„°ë¯¸ë„ì„ ì°¨ì§€
    - "ë””íƒœì¹˜ë“œ ëª¨ë“œëŠ” ì»¨í…Œì´ë„ˆë¥¼ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë™ì‘í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œì¨ ì‹¤í–‰í•˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤. ~~~ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ í”„ë¡œê·¸ë¨ì´ í„°ë¯¸ë„ì„ ì°¨ì§€í•˜ëŠ” í¬ê·¸ë¼ìš´ë“œë¡œ ì‹¤í–‰ë¼ ì‚¬ìš©ìì˜ ì…ë ¥ì„ ë°›ì§€ ì•ŠìŠµë‹ˆë‹¤. ë””íƒœì¹˜ë“œ ëª¨ë“œì¸ ì»¨í…Œì´ë„ˆëŠ” ë°˜ë“œì‹œ ì»¨í…Œì´ë„ˆì—ì„œ í”„ë¡œê·¸ë¨ì´ ì‹¤í–‰ë¼ì•¼ í•˜ë©°, í¬ê·¸ë¼ìš´ë“œ í”„ë¡œê·¸ë¨ì´ ì‹¤í–‰ë˜ì§€ ì•Šìœ¼ë©´ ì»¨í…Œì´ë„ˆëŠ” ì¢…ë£Œë©ë‹ˆë‹¤"???????????

      ì°¸ê³  ë§í¬ ) [https://roseline124.github.io/kuberdocker/2019/07/24/docker-study05.html#ë„ì»¤ì—ì„œ-foregroundì™€-background-ì‹¤í–‰](https://roseline124.github.io/kuberdocker/2019/07/24/docker-study05.html#%EB%8F%84%EC%BB%A4%EC%97%90%EC%84%9C-foreground%EC%99%80-background-%EC%8B%A4%ED%96%89)

    - ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì— í¬ê·¸ë¼ìš´ë“œ ë™ì‘ í”„ë¡œê·¸ë¨ì´ ìˆì–´ì•¼í•¨
    - ì»¨í…Œì´ë„ˆ ìì²´ëŠ” ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë™ì‘í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì²˜ëŸ¼ ì‹¤í–‰

### ë„ì»¤ ë³¼ë¥¨ ğŸŒŸ

- ì»¨í…Œì´ë„ˆ ì‚­ì œ ì‹œ, ë°ì´í„°ë² ì´ìŠ¤ ì •ë³´ ì‚­ì œë¨ â†’ í•´ê²°ë²•(ì•„ë˜)
- ë³¼ë¥¨ í™œìš©ë²•

  í˜¸ìŠ¤íŠ¸ì™€ ê³µìœ 

  ë³¼ë¥¨ ì»¨í…Œì´ë„ˆ í™œìš©

  ë„ì»¤ê°€ ê´€ë¦¬í•˜ëŠ” ë³¼ë¥¨ ìƒì„±

- í˜¸ìŠ¤íŠ¸ì™€ ê³µìœ 

    ```bash
    -v [í˜¸ìŠ¤íŠ¸ì˜ ê³µìœ  ë””ë ‰í„°ë¦¬]:[ì»¨í…Œì´ë„ˆì˜ ê³µìœ  ë””ë ‰í„°ë¦¬]
    ```

    ```bash
    # db ì»¨í…Œì´ë„ˆ ìƒì„±
    docker run -d \
    --name wordpressdb_hostvolume \
    -e MYSQL_ROOT_PASSWORLD=password \
    -e MYSQL_DATABASE=wordpress \
    -v /home/wordpress_db:/var/lib/mysql \
    mysql:5.7

    # ì›Œë“œí”„ë ˆìŠ¤ ì›¹ ì„œë²„ ì»¨í…Œì´ë„ˆ ìƒì„±
    docker run -d \
    --name wordpress_hostvolume \
    -e WORDPRESS_DB_PASSWORLD=password \
    -p 80 \
    --link wordpressdb_hostvolume:mysql \
    wordpress
    ```

  -v ì˜µì…˜ìœ¼ë¡œ í˜¸ìŠ¤íŠ¸ì˜ ë””ë ‰í„°ë¦¬(/home/wordpress_db)ì™€ ì»¨í…Œì´ë„ˆì˜ ë””ë ‰í„°ë¦¬(/var/lib/mysql)ê³µìœ 

  ë™ê¸°í™”(x) ë™ì¼í•œ ë””ë ‰í„°ë¦¬(o)

  ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë””ë ‰í„°ë¦¬ : ì»¨í…Œì´ë„ˆì˜ ë””ë ‰í„°ë¦¬ê°€ ë®ì–´ì”Œì›Œì§

  (í˜¸ìŠ¤íŠ¸ì˜ ë””ë ‰í„°ë¦¬ ì»¨í…Œì´ë„ˆì˜ ë””ë ‰í„°ë¦¬ì— ë§ˆìš´íŠ¸)

- ë³¼ë¥¨ ì»¨í…Œì´ë„ˆ í™œìš©

  ë³¼ë¥¨ì„ ì‚¬ìš©í•˜ëŠ” ì»¨í…Œì´ë„ˆë¥¼ ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆì™€ ê³µìœ 

    ```bash
    --volumes-from [ì´ë¯¸ ë³¼ë¥¨ ì˜µì…˜ì„ ì ìš©í•œ ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆ]
    ```

    ```bash
    docker run -i -t \
    --name volumes_from_container \
    --volumes-from volume_override \
    ubuntu:14.04
    ```

- ë„ì»¤ ë³¼ë¥¨

    ```bash
    # ë³¼ë¥¨ ìƒì„±
    docker volume create --name [ë³¼ë¥¨ ì´ë¦„]

    # ë³¼ë¥¨ ìƒì„± í™•ì¸
    docker volume ls

    # ë³¼ë¥¨ ìƒì„± ì‹œ ë“œë¼ì´ë²„
    # ë¡œì»¬ : ë¡œì»¬ í˜¸ìŠ¤íŠ¸ì— ì €ì¥
    # ë‹¤ë¥¸ í”ŒëŸ¬ê·¸ì¸ ë“œë¼ì´ë²„ ì„¤ì • ê°€ëŠ¥

    # ë³¼ë¥¨ ì‚¬ìš©í•˜ëŠ” ì»¨í…Œì´ë„ˆ ìƒì„±
    [ë³¼ë¥¨ ì´ë¦„]:[ì»¨í…Œì´ë„ˆì˜ ê³µìœ  ë””ë ‰í„°ë¦¬]

    docker run -i -t --name myvolume_1 \
    -v myvolume:/root/ \
    ubuntu:14.04
    # ì»¨í…Œì´ë„ˆ ë³¼ë¥¨ì„ ì»¨í…Œì´ë„ˆì˜ /root/ ë””ë ‰í„°ë¦¬ì— ë§ˆìš´íŠ¸
    # /root/ ë””ë ‰í„°ë¦¬ì— íŒŒì¼ ì“°ë©´ í•´ë‹¹ íŒŒì¼ì´ ë³¼ë¥¨ì— ì €ì¥

    # ì—¬ëŸ¬ ì»¨í…Œì´ë„ˆì—ì„œ ê³µìœ  ê°€ëŠ¥
    docker run -i -t --name myvolume_2 \
    -v myvolume:/root/ \
    ubuntu:14.04

    cat /root/volume
    hello, volume!

    # ë³¼ë¥¨ ì €ì¥ ìœ„ì¹˜
    docker inspect --type volume [ë³¼ë¥¨ ì´ë¦„]
    # --type ì˜µì…˜ì— image, container ë“± ë‹¤ë¥¸ ì¢…ë¥˜ ì •ë³´ ì…ë ¥ ê°€ëŠ¥

    # ë³¼ë¥¨ ìë™ ìƒì„±
    docker run -i -t --name myvolume_1 \
    -v /root/ \ # ì´ë¦„ ë¬´ì‘ìœ„ë¡œ í•´ë‹¹ ê²½ë¡œì— ë³¼ë¥¨ ìë™ ìƒì„±
    ubuntu:14.04

    # ë³¼ë¥¨ ì „ì²´ ì‚­ì œ
    docker volume prune
    ```

### ë„ì»¤ ë„¤íŠ¸ì›Œí¬

- ë„ì»¤ ë„¤íŠ¸ì›Œí¬ êµ¬ì¡°

  ì—¬ëŸ¬ ë„ì»¤ ì»¨í…Œì´ë„ˆ(eth0, lo) â†’ ê°ê°ì˜ veth.. (í˜¸ìŠ¤íŠ¸ ì¸í„°í˜ì´ìŠ¤)

  â†’ docker0(ë¸Œë¦¬ì§€, vethì™€ ë°”ì¸ë”©ë˜ì–´ ì™¸ë¶€ í†µì‹ )

  â†’ eth0(ì™¸ë¶€ í†µì‹  ê°€ëŠ¥, í˜¸ìŠ¤íŠ¸ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤) í˜¸ìŠ¤íŠ¸ ë¨¸ì‹ 

- ë„ì»¤ ë„¤íŠ¸ì›Œí¬ ê¸°ëŠ¥
    - ë„ì»¤ ì œê³µ ë„¤íŠ¸ì›Œí¬ ë“œë¼ì´ë²„ : ë¸Œë¦¬ì§€, í˜¸ìŠ¤íŠ¸, ë…¼, ì»¨í…Œì´ë„ˆ, ì˜¤ë²„ë ˆì´ ...
    - ì„œë“œíŒŒí‹° í”ŒëŸ¬ê·¸ì¸ ì†”ë£¨ì…˜ : weave, flannel, openvswitch ...
- ë„ì»¤ ë„¤íŠ¸ì›Œí¬ ë‹¤ë£¨ê¸°

    ```bash
    # ë„ì»¤ ë„¤íŠ¸ì›Œí¬ ëª©ë¡ í™•ì¸
    docker network ls

    # ë„ì»¤ ë„¤íŠ¸ì›Œí¬ ì •ë³´ ë³´ê¸°
    docker network inspect bridge
    # or
    docker inspect --type network
    ```

- ë¸Œë¦¬ì§€ ë„¤íŠ¸ì›Œí¬ : docker0ì´ ì•„ë‹Œ ì‚¬ìš©ì ì •ì˜ ë¸Œë¦¬ì§€ë¥¼ ìƒˆë¡œ ìƒì„±í•´ ê° ì»¨í…Œì´ë„ˆì— ì—°ê²°

  â€”net-alias ì˜µì…˜ : íŠ¹ì • í˜¸ìŠ¤íŠ¸ ì´ë¦„ìœ¼ë¡œ ì—¬ëŸ¬ ì»¨í…Œì´ë„ˆ ì ‘ê·¼ ê°€ëŠ¥

- í˜¸ìŠ¤íŠ¸ ë„¤íŠ¸ì›Œí¬ : í˜¸ìŠ¤íŠ¸ì˜ ë„¤íŠ¸ì›Œí¬ í™˜ê²½ ê·¸ëŒ€ë¡œ ì´ìš©
- ë…¼ ë„¤íŠ¸ì›Œí¬ : ì•„ë¬´ ë„¤íŠ¸ì›Œí¬ë¥¼ ì“°ì§€ ì•ŠìŒ, ì™¸ë¶€ì™€ ì—°ê²° ë‹¨ì ˆ
- ì»¨í…Œì´ë„ˆ ë„¤íŠ¸ì›Œí¬ : ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆì˜ ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í™˜ê²½ ê³µìœ 

  (ê°™ì€ eth0ë¡œ veth.. docker0 eth0ê¹Œì§€ ë°”ì¸ë”©)

- MacVLAN ë„¤íŠ¸ì›Œí¬ : í˜¸ìŠ¤íŠ¸ì˜ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ì¹´ë“œ â†’ ê°€ìƒí™” â†’ ë¬¼ë¦¬ ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì„ ì»¨í…Œì´ë„ˆì— ë™ì¼í•˜ê²Œ ì œê³µ

  ë¬¼ë¦¬ ë„¤íŠ¸ì›Œí¬ ìƒ ê°€ìƒì˜ ë§¥ ì£¼ì†Œ ê°€ì§

  í•´ë‹¹ ë„¤íŠ¸ì›Œí¬(ë™ì¼í•œ IP ëŒ€ì—­)ì— ì—°ê²°ëœ ë‹¤ë¥¸ ì¥ì¹˜ì™€ í†µì‹  ê°€ëŠ¥

  êµ¬ì¡° : ë„¤íŠ¸ì›Œí¬ ì¥ë¹„(ê³µìœ ê¸°, ë¼ìš°í„°, ìŠ¤ìœ„ì¹˜)ì— ì—¬ëŸ¬ ì„œë²„ì™€ ì»¨í…Œì´ë„ˆ ì—°ê²°, ê° ì„œë²„ê°€ ê°™ì€ ëŒ€ì—­ì—ì„œ IP ë™ì  í• ë‹¹ ë°›ì„ ë•Œ, MacVLANìœ¼ë¡œ ì„œë¡œ í†µì‹  ê°€ëŠ¥

### ì»¨í…Œì´ë„ˆ ë¡œê¹…

- json-file ë¡œê·¸

  JSON í˜•íƒœë¡œ ë„ì»¤ ë‚´ë¶€ì— ì €ì¥

    ```bash
    # ë„ì»¤ ë¡œê·¸ ì¶œë ¥
    docker logs [ì»¨í…Œì´ë„ˆ ì´ë¦„]

    # ë§ˆì§€ë§‰ ëª‡ ì¤„ë§Œ ì¶œë ¥
    docker logs --tail [ì¶œë ¥í•  ì¤„ ìˆ˜] [ì»¨í…Œì´ë„ˆ ì´ë¦„]
    ```

- syslog ë¡œê·¸

    ```bash
    --log-driver=syslog
    ```

- fluentd ë¡œê¹…

  ì˜¤í”ˆì†ŒìŠ¤ ë„êµ¬

  ë„ì»¤ ì—”ì§„ ì»¨í…Œì´ë„ˆ í”ŒëŸ¬ê·¸ì¸ ê³µì‹ì  ì œê³µ

  ìˆ˜ì§‘ ë°ì´í„° ë‹¤ì–‘í•œ ì €ì¥ì†Œì— ì €ì¥ ê°€ëŠ¥

  fluentd & MongoDB ì—°ë™ : ë„ì»¤ ì„œë²„ë“¤ (ë¡œê·¸ ìˆ˜ì§‘) â†’ fluentd ì„œë²„ â†’ MongoDB ì„œë²„ (ë¡œê·¸ ì €ì¥)

- ì•„ë§ˆì¡´ í´ë¼ìš°ë“œì›Œì¹˜ ë¡œê·¸

  ë„ì»¤ë¥¼ AWS EC2ì—ì„œ ì‚¬ìš©í•˜ë©´ ë³„ë„ ì„¤ì¹˜ ì—†ì´ ì‚¬ìš© ê°€ëŠ¥

# 2.3 ë„ì»¤ ì´ë¯¸ì§€

### ë„ì»¤í—ˆë¸Œ

- ì¤‘ì•™ ì´ë¯¸ì§€ ì €ì¥ì†Œ
- ë„ì»¤ ê³„ì •ë§Œ ìˆìœ¼ë©´ ëˆ„êµ¬ë“ ì§€ ì´ë¯¸ì§€ ì˜¬ë¦¬ê³  ë‚´ë ¤ë°›ì„ ìˆ˜ ìˆìŒ
- ê³µì‹ ë¼ë²¨ì´ ì—†ìœ¼ë©´ ì‚¬ìš©ë²•, ë™ì‘ì— ë¬¸ì œ ìˆì„ ìˆ˜ ìˆìŒ

`docker search`: ë„ì»¤ í—ˆë¸Œ ì´ë¯¸ì§€ í™•ì¸

```bash
# ubuntu ê°€ ë“¤ì–´ê°€ëŠ” ë„ì»¤ ì´ë¯¸ì§€ ê²€ìƒ‰ 
docker search ubuntu
```

## 2.3.1 ë„ì»¤ ì´ë¯¸ì§€ ìƒì„±

ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ ì‘ì—…í•œ ë‚´ìš©ì„ ì´ë¯¸ì§€ë¡œ ë§Œë“œëŠ” ë°©ë²•

```bash
# ì»¨í…Œì´ë„ˆ ìƒì„±
docker run -i -t --name commit_test ubuntu:14.04

# first ë¼ëŠ” ì´ë¦„ì˜ íŒŒì¼ì„ ìƒì„±í•´ ê¸°ì¡´ ì´ë¯¸ì§€ë¡œë¶€í„° ë³€ê²½ì‚¬í•­ ë§Œë“ ë‹¤.
echo test_first! >> first
```

ì»¨í…Œì´ë„ˆì—ì„œ í˜¸ìŠ¤íŠ¸ë¡œ ë¹ ì ¸ë‚˜ì™€(ctrl + P, Q) docker commit ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•´ ì»¨í…Œì´ë„ˆ â†’ ì´ë¯¸ì§€ë¡œ ë§Œë“ ë‹¤.

```bash
docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]
```

commit_test ë¼ëŠ” ì»¨í…Œì´ë„ˆë¥¼ commit_test:first ë¼ëŠ” ì´ë¦„ì˜ ì´ë¯¸ì§€ë¡œ ìƒì„±

```bash
$ docker commit -a "alicek106" -m "my first commit" commit_test commit_test:first
sha256:d9c26f92d805df453008385d6b0b97e69c12fc973d5ccd27845643b61515ae4f
```

- ì €ì¥ì†Œ ì´ë¦„ì€ ì…ë ¥í•˜ì§€ ì•Šì•„ë„ ìƒê´€ ì—†ìŒ
- ì´ë¯¸ì§€ íƒœê·¸ ë¥¼ ì…ë ¥í•˜ì§€ ì•Šìœ¼ë©´ ìë™ìœ¼ë¡œ `latest` ë¡œ ì„¤ì •
- `-a` : author, ì´ë¯¸ì§€ ì‘ì„±ìë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë©”íƒ€ë°ì´í„°
- `-m` : ì»¤ë°‹ ë©”ì‹œì§€

### ì´ë¯¸ì§€ ìƒì„± í™•ì¸

```bash
docker images
```

`commit_test:first` ì´ë¯¸ì§€ë¡œ ìƒˆë¡œìš´ ì´ë¯¸ì§€ ìƒì„±í•˜ê¸°

```bash
$ docker run -i -t --name commit_test2 commit_test:first
root@58fb817da0ca:/# echo test_second! >> second

# ctrl + P, Q

$ docker commit -a "mijeong" -m "my second commit" commit_test2 commit_test:second
sha256:f88f3e5d25121a8cba051bd89955198a73c296e1e3bc36d55b755da8e1340176

$ docker images
```

## 2.3.2 ì´ë¯¸ì§€ êµ¬ì¡° ì´í•´

`docker inspect`

```bash
$ docker inspect ubuntu:14.04
$ docker inspect commit_test:first
$ docker inspect commit_test:second
```

- ì»¨í…Œì´ë„ˆ, ë³¼ë¥¨, ì´ë¯¸ì§€ ë“± ë„ì»¤ ë‹¨ìœ„ ì •ë³´ ì–»ì„ ë•Œ ì‚¬ìš©
- ì´ë¦„ì´ ì¤‘ë³µë  ê²½ìš° ì»¨í…Œì´ë„ˆ ë¨¼ì € ìˆ˜í–‰. `--type` ëª…ì‹œí•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

### Layers

```bash
"Layers": [
    "sha256:f2fa9f4cf8fd0a521d40e34492b522cee3f35004047e617c75fadeb8bfd1e6b7",
    "sha256:30d3c4334a2379748937816c01f5c972a8291a5ccc958d6b33d735457a16196e",
    "sha256:83109fa660b2ed9307948505abd3c1f24c27c64009691067edb765bd3714b98d"
    ]
```

- (í˜¸ìŠ¤íŠ¸ì˜ ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ì´) 3ê°œì˜ ì´ë¯¸ì§€ í¬ê¸°ê°€ ê°ê° 197MB ì—¬ë„ 197MB x 3 ì´ ì•„ë‹˜
- ì´ë¯¸ì§€ ì»¤ë°‹í•  ë•Œ ì»¨í…Œì´ë„ˆì—ì„œ 'ë³€ê²½ëœ ì‚¬í•­ë§Œ ìƒˆë¡œìš´ ë ˆì´ì–´ë¡œ ì €ì¥' â†’ ì‹¤ì œ ì´ë¯¸ì§€ í¬ê¸° = 197MB+firstíŒŒì¼í¬ê¸° + second íŒŒì¼í¬ê¸°
- ì´ë¯¸ì§€ ë ˆì´ì–´ êµ¬ì¡°ëŠ” `docker history` ë¡œ ë” ì‰½ê²Œ í™•ì¸ ê°€ëŠ¥

    ```bash
    $ sudo docker history commit_test:second
    IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT
    f88f3e5d2512        10 minutes ago      /bin/bash                                       13 B                my second commit
    d9c26f92d805        17 minutes ago      /bin/bash                                       11 B                my first commit
    13b66b487594        5 weeks ago         /bin/sh -c #(nop)  CMD ["/bin/bash"]            0 B                 
    <missing>           5 weeks ago         /bin/sh -c mkdir -p /run/systemd && echo '...   7 B                 
    <missing>           5 weeks ago         /bin/sh -c [ -z "$(apt-get indextargets)" ]     0 B                 
    <missing>           5 weeks ago         /bin/sh -c set -xe   && echo '#!/bin/sh' >...   195 kB              
    <missing>           5 weeks ago         /bin/sh -c #(nop) ADD file:276b5d943a4d284...   196 MB
    ```

### ì´ë¯¸ì§€ ì‚­ì œ

```bash
$ docker rmi commit_test:first
```

- ì´ë¯¸ì§€ ì‚¬ìš©ì¤‘ì¸ ì»¨í…Œì´ë„ˆ ì¡´ì¬í•˜ë¯€ë¡œ ì‚­ì œí•  ìˆ˜ ì—†ë‹¤ëŠ” ì—ëŸ¬ ë‚˜ì˜´
- `docker rm -f [ì»¨í…Œì´ë„ˆ ì´ë¦„]`ìœ¼ë¡œ ê°•ì œ ì‚­ì œ ê°€ëŠ¥ â†’ ë ˆì´ì–´íŒŒì¼ ì‚­ì œê°€ ì•„ë‹Œ ì´ë¯¸ì§€ ì´ë¦„ë§Œ ì‚­ì œ
    - ì´ ê²½ìš° ì´ë¯¸ì§€ ì´ë¦„ì´ <none> ìœ¼ë¡œ ë³€ê²½ â†’ ëŒ•ê¸€ë§(dangling) ì´ë¯¸ì§€ ë¼ê³  ë¶€ë¦„
    - `docker images -f dangling=true` ë¡œ í™•ì¸ ê°€ëŠ¥
    - `docker image prune` ìœ¼ë¡œ í•œêº¼ë²ˆì— ì‚­ì œ ê°€ëŠ¥

ë”°ë¼ì„œ, ì•„ë˜ì™€ ê°™ì´ ì‚­ì œ

```bash
$ docker stop commit_test2 && docker rm commit_test2  
$ docker rmi commit_test:first
Untagged: commit_test:first
```

- `commit_test:first` ì˜ ë ˆì´ì–´ íŒŒì¼ì´ ì‚­ì œë˜ì§€ëŠ” ì•ŠìŒ : ë ˆì´ì–´ì— ë¶€ì—¬ëœ ì´ë¦„ë§Œ ì‚­ì œ = `Untagged`
- `commit_test:first` ê¸°ë°˜ì˜ í•˜ìœ„ ì´ë¯¸ì§€ ì¡´ì¬í•˜ê¸° ë•Œë¬¸

`coomit_test:second` ëŠ” ì‚¬ìš©ì¤‘ì¸ ì»¨í…Œì´ë„ˆê°€ ì—†ìœ¼ë¯€ë¡œ ë°”ë¡œ ì‚­ì œ ê°€ëŠ¥

```bash
$ sudo docker rmi commit_test:second
Untagged: commit_test:second
Deleted: sha256:f88f3e5d25121a8cba051bd89955198a73c296e1e3bc36d55b755da8e1340176
Deleted: sha256:5023970d39889a09856b76bd1feb9074fa772981f845770c11d9f171d2025e3a
Deleted: sha256:d9c26f92d805df453008385d6b0b97e69c12fc973d5ccd27845643b61515ae4f
Deleted: sha256:c9c63f38d9f11fff3bcc095325ca7cdcc3705ad70e36f0a4fe1888bc3eef7288
```

- Deleted: ì´ë¯¸ ë ˆì´ì–´ê°€ ì‚­ì œë¨
- ì‹¤ì œ ë ˆì´ì–´ íŒŒì¼ì€

ubuntu â† first â† second ê·¸ë ‡ë‹¤ë©´ echo ë¡œ ë§Œë“  íŒŒì¼ì€ ì–¸ì œ ì‚­ì œë˜ëŠ”ê°€...?

```bash
[irteamsu@dev-2021-newbiew-ncl ~]$ sudo docker rmi t1:s
Untagged: t1:s
Deleted: sha256:dd1b33b522dcd76bb90beeb001dd67ee8246b3a1bdfd78e7c4c65e68af2f9c47
```

t1:f ë¥¼ ì§€ìš¸ë• ì•„ë¬´ê²ƒë„ ëœ¨ì§€ì•ŠìŒ... why?

```bash
"Layers": [
                "sha256:f2fa9f4cf8fd0a521d40e34492b522cee3f35004047e617c75fadeb8bfd1e6b7",
                "sha256:30d3c4334a2379748937816c01f5c972a8291a5ccc958d6b33d735457a16196e",
                "sha256:83109fa660b2ed9307948505abd3c1f24c27c64009691067edb765bd3714b98d",
                "sha256:c99e1dc7f6f1a14f0e3bc47375e2baaee3a05e9eccec641c6c9da7c9d78b482d",
                "sha256:754aeba662aae0f214591020f5083c4c7460854f5c6dd33dbd9df9b2c1c66012"
            ]
```

```bash
"Layers": [
                "sha256:f2fa9f4cf8fd0a521d40e34492b522cee3f35004047e617c75fadeb8bfd1e6b7",
                "sha256:30d3c4334a2379748937816c01f5c972a8291a5ccc958d6b33d735457a16196e",
                "sha256:83109fa660b2ed9307948505abd3c1f24c27c64009691067edb765bd3714b98d",
                "sha256:c99e1dc7f6f1a14f0e3bc47375e2baaee3a05e9eccec641c6c9da7c9d78b482d"
            ]
```

## 2.3.3 ì´ë¯¸ì§€ ì¶”ì¶œ

ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë‹¨ì¼ ë°”ì´ë„ˆë¦¬ íŒŒì¼ë¡œ ì €ì¥í•´ì•¼ í•  ë•Œê°€ ìˆìŒ

```bash
docker save -o ubuntu_14_04.tar ubuntu:14.04
```

- `-o`: ì¶”ì¶œë  íŒŒì¼ëª…
- ì»¨í…Œì´ë„ˆ ì»¤ë§¨ë“œ, ì´ë¯¸ì§€ ì´ë¦„, íƒœê·¸ ë“± ëª¨ë“  ë©”íƒ€ë°ì´í„° í¬í•¨í•´ íŒŒì¼ë¡œ ì¶”ì¶œ

ì¶”ì¶œëœ ì´ë¯¸ì§€ ë‹¤ì‹œ ë„ì»¤ì— ë¡œë“œ

```bash
docker load -i ubuntu_14_04.tar
```

ìœ ì‚¬í•œ `export` ì™€ `import` ê°€ ìˆìŒ

- export ëŠ” ì»¨í…Œì´ë„ˆì˜ íŒŒì¼ì‹œìŠ¤í…œì„ tar íŒŒì¼ë¡œ ì¶”ì¶œ
- ì»¨í…Œì´ë„ˆ ë° ì´ë¯¸ì§€ì— ëŒ€í•œ ì„¤ì •ì •ë³´ ì €ì¥ x

```bash
docker export -o rootFS.tar mycontainer
docker import roofFS.tar myimage:0.0
```

- ì¶”ì¶œëœ ì´ë¯¸ì§€ëŠ” ë ˆì´ì–´ êµ¬ì¡°ê°€ ì•„ë‹Œ ë‹¨ì¼ íŒŒì¼ : ì´ë¯¸ì§€ ìš©ëŸ‰ì„ ê°ê¸° ì°¨ì§€ (íš¨ìœ¨ì x)

## 2.3.4 ì´ë¯¸ì§€ ë°°í¬

1. ë„ì»¤ í—ˆë¸Œ ì´ë¯¸ì§€ ì €ì¥ì†Œ ì‚¬ìš©
2. ë„ì»¤ ì‚¬ì„¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì‚¬ìš© â†’ harbor

### 2.3.4.1 ë„ì»¤ í—ˆë¸Œ ì €ì¥ì†Œ

[https://hub.docker.com/](https://hub.docker.com/)

### ì €ì¥ì†Œì— ì´ë¯¸ì§€ ì˜¬ë¦¬ê¸°

```bash
$ sudo docker run -i -t --name commit_container1 ubuntu:14.04
root@ad82c9e09834:/# echo my first push >> test

# crtl + P, Q

$ sudo docker commit commit_container1 my-image-name:0.0
sha256:a7268598131ebd36df7908489fd901ff31f22132c9005187e81647c6cf8e17a1
```

â†’ ubuntu:14.04 ì´ë¯¸ì§€ì— test íŒŒì¼ ìƒì„±í•œ í›„ my-image-name:0.0 ì´ë¯¸ì§€ë¡œ ì»¤ë°‹

- ì´ë¯¸ì§€ ì´ë¦„ì˜ ì ‘ë‘ì–´ëŠ” ì´ë¯¸ì§€ê°€ ì €ì¥ë˜ëŠ” ì €ì¥ì†Œ ì´ë¦„ìœ¼ë¡œ ì„¤ì •í•´ì•¼ í•¨
- docker tag ë¡œ ì´ë¯¸ì§€ ì´ë¦„ ì¶”ê°€ ê°€ëŠ¥

```bash
# docker tag [ê¸°ì¡´ì˜ ì´ë¯¸ì§€ ì´ë¦„][ìƒˆë¡­ê²Œ ìƒì„±ë  ì´ë¯¸ì§€ ì´ë¦„]
docker tag my-image-name:0.0 suelmj/my-image-name:0.0
```

ë„ì»¤ í—ˆë¸Œ ë¡œê·¸ì¸

```bash
docker login
```

PUSH

```bash
$ docker push suelmj/my-image-name:0.0
The push refers to a repository [docker.io/suelmj/my-image-name]
98b095e8a52f: Pushed 
83109fa660b2: Mounted from library/ubuntu 
30d3c4334a23: Mounted from library/ubuntu 
f2fa9f4cf8fd: Mounted from library/ubuntu 
0.0: digest: sha256:5ad3f07ac3746b3df175ef6a0e4e4f8bbd732925943b54bf285787d7e330258d size: 1152
```

PULL

```bash
docker suelmj/my-image-name:0.0
```